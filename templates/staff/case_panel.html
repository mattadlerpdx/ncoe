{{define "case_panel.html"}}
{{with .Case}}
<div class="px-3 px-md-0">
<!-- Case Header -->
<div class="mb-4">
    <div class="d-flex align-items-center mb-3">
        <div class="bg-primary bg-opacity-10 rounded-circle p-3 me-3">
            {{if eq .Type "AO"}}<i class="bi bi-file-earmark-text text-primary fs-3"></i>
            {{else if eq .Type "EC"}}<i class="bi bi-exclamation-triangle text-danger fs-3"></i>
            {{else if eq .Type "EA"}}<i class="bi bi-check-circle text-success fs-3"></i>
            {{else if eq .Type "PRR"}}<i class="bi bi-folder2-open text-info fs-3"></i>
            {{else}}<i class="bi bi-folder text-primary fs-3"></i>{{end}}
        </div>
        <div>
            <h5 class="mb-0 font-monospace">{{.CaseNumber}}</h5>
            <small class="text-muted">
                {{if eq .Type "AO"}}Advisory Opinion
                {{else if eq .Type "EC"}}Ethics Complaint
                {{else if eq .Type "EA"}}Acknowledgment
                {{else if eq .Type "PRR"}}Records Request
                {{else}}{{.Type}}{{end}}
            </small>
        </div>
    </div>

    <!-- Status Badge -->
    {{if .IsOverdue}}
    <div class="alert alert-danger py-2 mb-3">
        <i class="bi bi-exclamation-circle me-1"></i>
        <strong>Overdue!</strong> Due date was {{.DueDate.Format "Jan 2, 2006"}}
    </div>
    {{else if eq .Status "submitted"}}
    <div class="alert alert-info py-2 mb-3">
        <i class="bi bi-inbox me-1"></i>
        New submission - awaiting review
    </div>
    {{else if eq .Status "under_review"}}
    <div class="alert alert-primary py-2 mb-3">
        <i class="bi bi-eye me-1"></i>
        Under review
    </div>
    {{else if eq .Status "investigation"}}
    <div class="alert alert-warning py-2 mb-3">
        <i class="bi bi-search me-1"></i>
        Under investigation
    </div>
    {{else if eq .Status "draft_prepared"}}
    <div class="alert alert-secondary py-2 mb-3">
        <i class="bi bi-file-text me-1"></i>
        Draft prepared - awaiting approval
    </div>
    {{else if eq .Status "published"}}
    <div class="alert alert-success py-2 mb-3">
        <i class="bi bi-check-circle me-1"></i>
        Published
    </div>
    {{else if eq .Status "closed"}}
    <div class="alert alert-dark py-2 mb-3">
        <i class="bi bi-archive me-1"></i>
        Closed
    </div>
    {{end}}
</div>

<!-- Summary -->
<div class="mb-4">
    <h6 class="text-muted mb-2">Summary</h6>
    <p class="mb-0">{{.Summary}}</p>
</div>

<!-- Submitter Info -->
<div class="mb-4">
    <h6 class="text-muted mb-3">Submitter</h6>
    <div class="mb-2">
        <i class="bi bi-person me-2 text-muted"></i>
        {{.SubmitterName}}
    </div>
    {{if .SubmitterAgency}}
    <div class="mb-2">
        <i class="bi bi-building me-2 text-muted"></i>
        {{.SubmitterAgency}}
    </div>
    {{end}}
    {{if .SubmitterEmail}}
    <div class="mb-2">
        <i class="bi bi-envelope me-2 text-muted"></i>
        <a href="mailto:{{.SubmitterEmail}}">{{.SubmitterEmail}}</a>
    </div>
    {{end}}
    {{if .SubmitterPhone}}
    <div class="mb-2">
        <i class="bi bi-telephone me-2 text-muted"></i>
        {{.SubmitterPhone}}
    </div>
    {{end}}
</div>

<!-- Key Dates -->
<div class="mb-4">
    <h6 class="text-muted mb-3">Key Dates</h6>
    <div class="row g-2 text-center">
        <div class="col-6">
            <div class="border rounded p-2">
                <div class="fw-bold">{{.SubmittedAt.Format "Jan 2"}}</div>
                <small class="text-muted">Submitted</small>
            </div>
        </div>
        <div class="col-6">
            <div class="border rounded p-2 {{if .IsOverdue}}border-danger{{end}}">
                {{if not .DueDate.IsZero}}
                <div class="fw-bold {{if .IsOverdue}}text-danger{{end}}">{{.DueDate.Format "Jan 2"}}</div>
                <small class="text-muted">Due</small>
                {{else}}
                <div class="text-muted">-</div>
                <small class="text-muted">Due</small>
                {{end}}
            </div>
        </div>
    </div>
</div>

<!-- Assignment -->
<div class="mb-4">
    <h6 class="text-muted mb-3">Assignment</h6>
    {{if .AssignedToName}}
    <div class="d-flex align-items-center">
        <i class="bi bi-person-circle me-2 text-muted"></i>
        <span>{{.AssignedToName}}</span>
    </div>
    {{else}}
    <div class="text-muted">
        <i class="bi bi-person-dash me-2"></i>
        Unassigned
    </div>
    {{end}}
</div>

<!-- Documents -->
{{if $.Documents}}
<div class="mb-4">
    <h6 class="text-muted mb-3">Documents</h6>
    <div class="list-group list-group-flush">
        {{range $.Documents}}
        <a href="/staff/documents/{{.ID}}" class="list-group-item list-group-item-action px-0 d-flex justify-content-between align-items-center">
            <div>
                <i class="bi bi-file-earmark me-2"></i>
                {{.Filename}}
            </div>
            <small class="text-muted">{{.Size}}</small>
        </a>
        {{end}}
    </div>
</div>
{{end}}

<!-- Timeline (Recent Activity) -->
{{if $.Activity}}
<div class="mb-4">
    <h6 class="text-muted mb-3">Recent Activity</h6>
    <div class="timeline">
        {{range $.Activity}}
        <div class="timeline-item {{.Action}}">
            <div class="small text-muted">{{.CreatedAt.Format "Jan 2, 3:04 PM"}}</div>
            <div>{{.Description}}</div>
            {{if .UserName}}<small class="text-muted">by {{.UserName}}</small>{{end}}
        </div>
        {{end}}
    </div>
</div>
{{end}}

<!-- Actions -->
<div class="border-top pt-3">
    <h6 class="text-muted mb-3">Actions</h6>

    <!-- Update Status -->
    <div class="mb-3">
        <label class="form-label small">Update Status</label>
        <form hx-post="/staff/cases/{{.ID}}/_status" hx-swap="none">
            <input type="hidden" name="csrf_token" value="{{$.CSRFToken}}">
            <div class="input-group">
                <select name="status" class="form-select form-select-sm">
                    <option value="submitted" {{if eq .Status "submitted"}}selected{{end}}>New/Submitted</option>
                    <option value="under_review" {{if eq .Status "under_review"}}selected{{end}}>Under Review</option>
                    <option value="investigation" {{if eq .Status "investigation"}}selected{{end}}>Investigation</option>
                    <option value="draft_prepared" {{if eq .Status "draft_prepared"}}selected{{end}}>Draft Prepared</option>
                    <option value="published" {{if eq .Status "published"}}selected{{end}}>Published</option>
                    <option value="closed" {{if eq .Status "closed"}}selected{{end}}>Closed</option>
                </select>
                <button type="submit" class="btn btn-sm btn-primary">Update</button>
            </div>
        </form>
    </div>

    <!-- View Full Details -->
    <a href="/staff/cases/{{.ID}}" class="btn btn-outline-primary w-100 mb-2">
        <i class="bi bi-arrow-right me-1"></i>View Full Details
    </a>

    {{if .SubmitterEmail}}
    <a href="mailto:{{.SubmitterEmail}}" class="btn btn-outline-secondary w-100">
        <i class="bi bi-envelope me-1"></i>Email Submitter
    </a>
    {{end}}
</div>
</div>
{{end}}
{{end}}
